<!doctype html>
<html>

<head>
  <meta charset="utf-8">
  <title>Where is Bunny?</title>
  <style>
    canvas {
      width: 100%;
      /*width: 960px;*/
      border: 1px solid black;
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/4.6.2/pixi.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
</head>


<body>
  <div style="width: 100%; max-width: 960px; margin: auto;" id="main">
    <h1>Where is Bunny?</h1>
  </div>
  <script>


    PIXI.loader
      .add('resources/bunny.json')
      .add('resources/rat.json')
      .add('resources/treea.json')
      .load(onAssetsLoaded);

    function onAssetsLoaded() {

      function animations() {
        var anims = [
          ['bunny0.png'],
          ['bunny5.png'],
          ['bunny0.png', 'bunny1.png'],
          ['bunny2.png', 'bunny3.png'],
          ['bunny4.png', 'bunny5.png'],
          ['bunny0.png', 'bunny0.png', 'bunny0.png', 'bunny3.png'],
          ['bunny0.png', 'bunny1.png', 'bunny0.png', 'bunny3.png'],
          ['bunny4.png', 'bunny4.png', 'bunny4.png', 'bunny4.png', 'bunny5.png'],
          ['bunny0.png', 'bunny0.png', 'bunny0.png', 'bunny1.png', 'bunny0.png', 'bunny0.png', 'bunny0.png', 'bunny0.png', 'bunny3.png'],
          ['rat0.png'],
          ['rat0.png', 'rat2.png'],
          ['rat2.png', 'rat3.png'],
          ['rat3.png', 'rat3.png', 'rat4.png'],
          ['rat0.png', 'rat0.png', 'rat0.png', 'rat1.png'],
          ['rat2.png', 'rat2.png', 'rat2.png', 'rat3.png'],
          ['rat0.png', 'rat1.png', 'rat0.png', 'rat0.png', 'rat2.png'],
          ['rat0.png', 'rat0.png', 'rat0.png', 'rat1.png', 'rat0.png', 'rat0.png', 'rat2.png', 'rat0.png', 'rat0.png', 'rat0.png', 'rat3.png'],
        ];
        var animations = [];
        for (var i = 0; i < anims.length; i++) {
          var frames = [];
          for (var j = 0; j < anims[i].length; j++) {
            frames.push(PIXI.Texture.fromFrame(anims[i][j]));
          }
          animations.push(frames);
        }
        return animations;
      }

      function animated_sprites(n) {
        var sprites = [];
        for (var i = 0; i < n; i++) {
          var anim = new PIXI.extras.AnimatedSprite(_.sample(animations));
          anim.x = _.random(24, app.renderer.width - 24);
          anim.y = _.random(24, app.renderer.height - 24);
          anim.anchor.set(1);
          anim.animationSpeed = 1 / _.random(30, 180);
          anim.play();
          sprites.push(anim);

        }
        return sprites;

      }

      var app = new PIXI.Application(480, 200, { backgroundColor: 0xffffff });
      document.getElementById('main').appendChild(app.view);

      var animations = animations();
      sprites = animated_sprites(25);
      sprites = _.sortBy(sprites, 'y');

      // Draw
      for (var i = 0; i < sprites.length; i++) {
        app.stage.addChild(sprites[i]);
      }

    }

  </script>
</body>

</html>